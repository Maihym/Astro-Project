---
import Layout from '../layouts/Layout.astro'
import { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card'
import { Badge } from '../components/ui/badge'
import { Button } from '../components/ui/button'
import { Star, Quote, ExternalLink, MessageCircle } from 'lucide-react'
import { getCompanyInfo, getSocialLinks } from '../config/business'
import reviewsData from '../data/reviews/reviews.json'

const companyInfo = getCompanyInfo()
const socialLinks = getSocialLinks()

// Use real reviews data from JSON file and sort them properly
const reviews = reviewsData
  .map((review, index) => ({
    id: index + 1,
    name: review.author,
    location: review.location,
    rating: review.rating,
    date: review.date,
    platform: "Yelp", // Most reviews appear to be from Yelp based on the data structure
    text: review.text,
    service: review.service || "Electrical Service"
  }))
  .sort((a, b) => {
    // Sort by rating first (highest first), then by date (newest first)
    if (b.rating !== a.rating) {
      return b.rating - a.rating;
    }
    // If ratings are the same, sort by date (newest first)
    // Handle date parsing for various formats
    const dateA = new Date(a.date).getTime() || 0;
    const dateB = new Date(b.date).getTime() || 0;
    return dateB - dateA;
  })

// Calculate average rating from real data
const averageRating = (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length).toFixed(1)
const totalReviews = reviews.length

// Calculate platform stats from real data
const platformStats = [
  { platform: "Yelp", rating: averageRating, count: totalReviews }
]
---

<Layout title={`Customer Reviews - ${companyInfo.name}`} description={`Read customer reviews and testimonials for ${companyInfo.name}. See why our customers trust us for their electrical needs.`}>
  <main class="min-h-screen bg-background">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary/10 via-background to-secondary/10 py-16 md:py-24">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6">
            Customer Reviews
          </h1>
          <p class="text-xl md:text-2xl text-muted-foreground mb-8">
            See what our customers say about our electrical services
          </p>
          
          <!-- Overall Rating -->
          <div class="flex flex-col sm:flex-row items-center justify-center gap-6 mb-8">
            <div class="text-center">
              <div class="text-5xl font-bold text-primary mb-2">{averageRating}</div>
              <div class="flex items-center justify-center gap-1 mb-2">
                {Array.from({ length: 5 }).map(() => (
                  <Star className="h-6 w-6 fill-yellow-400 text-yellow-400" />
                ))}
              </div>
              <p class="text-muted-foreground">Based on {totalReviews}+ reviews</p>
            </div>
            
            <div class="hidden sm:block w-px h-16 bg-border"></div>
            
            <div class="text-center">
              <div class="text-2xl font-bold text-primary mb-2">24/7</div>
              <p class="text-muted-foreground">Emergency Service</p>
            </div>
            
            <div class="hidden sm:block w-px h-16 bg-border"></div>
            
            <div class="text-center">
              <div class="text-2xl font-bold text-primary mb-2">100%</div>
              <p class="text-muted-foreground">Satisfaction Rate</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Platform Stats -->
    <section class="py-16 bg-muted/30">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-12">Our Reviews Across Platforms</h2>
          <div class="grid md:grid-cols-3 gap-6">
            {platformStats.map((stat) => (
              <Card className="text-center">
                <CardContent className="pt-6">
                  <div class="text-3xl font-bold text-primary mb-2">{stat.rating}</div>
                  <div class="flex items-center justify-center gap-1 mb-3">
                    {Array.from({ length: 5 }).map(() => (
                      <Star className="h-5 w-5 fill-yellow-400 text-yellow-400" />
                    ))}
                  </div>
                  <h3 class="font-semibold text-lg mb-2">{stat.platform}</h3>
                  <p class="text-muted-foreground">{stat.count} reviews</p>
                  {stat.platform === "Yelp" && socialLinks.yelp && (
                    <Button variant="outline" size="sm" className="mt-4" asChild>
                      <a href={socialLinks.yelp} target="_blank" rel="noopener noreferrer">
                        <ExternalLink className="h-4 w-4 mr-2" />
                        View on Yelp
                      </a>
                    </Button>
                  )}
                </CardContent>
              </Card>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- Customer Reviews -->
    <section class="py-16">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-12">What Our Customers Say</h2>
           <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
             {reviews.slice(0, 12).map((review) => (
              <Card className="h-full">
                <CardHeader>
                  <div class="flex items-start justify-between mb-3">
                    <div>
                      <CardTitle className="text-lg">{review.name}</CardTitle>
                      <p class="text-sm text-muted-foreground">{review.location}</p>
                    </div>
                    <Badge variant="secondary">{review.platform}</Badge>
                  </div>
                  <div class="flex items-center gap-2 mb-2">
                    <div class="flex items-center gap-1">
                      {Array.from({ length: review.rating }).map(() => (
                        <Star className="h-4 w-4 fill-yellow-400 text-yellow-400" />
                      ))}
                    </div>
                    <span class="text-sm text-muted-foreground">{review.date}</span>
                  </div>
                  <Badge variant="outline" className="w-fit">{review.service}</Badge>
                </CardHeader>
                <CardContent>
                  <div class="flex items-start gap-2">
                    <Quote className="h-5 w-5 text-primary mt-1 flex-shrink-0" />
                    <p class="text-muted-foreground italic">"{review.text}"</p>
                  </div>
                </CardContent>
               </Card>
             ))}
           </div>
           
           {reviews.length > 12 && (
             <div class="text-center mt-8">
               <p class="text-muted-foreground mb-4">
                 Showing 12 of {totalReviews} reviews
               </p>
               <Button variant="outline" asChild>
                 <a href={socialLinks.yelp} target="_blank" rel="noopener noreferrer">
                   <ExternalLink className="h-4 w-4 mr-2" />
                   View All Reviews on Yelp
                 </a>
               </Button>
             </div>
           )}
         </div>
       </div>
     </section>

     <!-- Call to Action -->
    <section class="py-16 bg-primary text-primary-foreground">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h2 class="text-3xl md:text-4xl font-bold mb-6">
            Ready to Experience Our Quality Service?
          </h2>
          <p class="text-xl mb-8 opacity-90">
            Join our satisfied customers and get the electrical service you deserve
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <Button size="lg" variant="secondary" className="text-primary" asChild>
              <a href="/contact">
                <MessageCircle className="h-5 w-5 mr-2" />
                Get Free Quote
              </a>
            </Button>
            <Button size="lg" variant="outline" className="border-primary-foreground text-primary-foreground hover:bg-primary-foreground hover:text-primary" asChild>
              <a href="tel:(657) 239-6331">
                Call (657) 239-6331
              </a>
            </Button>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>
